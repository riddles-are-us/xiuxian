# 修仙宗门模拟器 🧙‍♂️

一个用 Rust 编写的修仙主题策略模拟游戏，支持 CLI 交互模式和 Web 版本。

## ✨ 特性

- 🎮 **多种游戏模式**
  - 交互模式：回合制手动管理宗门
  - 自动模式：观察AI运行模拟
  - **Web模式**：通过浏览器界面玩游戏 ⭐ 新增

- ⚔️ **完整的修仙系统**
  - 7个修为等级：炼气 → 筑基 → 金丹 → 元婴 → 化神 → 炼虚 → 渡劫
  - 弟子管理：内门、外门、亲传弟子
  - 天赋系统：5种灵根 + 特殊天赋
  - 渡劫系统：突破境界的考验

- 📋 **任务系统**
  - 采集任务：获取资源
  - 战斗任务：挑战妖兽
  - 探索任务：发现秘境
  - 辅助任务：提升道心

- 🌍 **地图元素**
  - 村落、宗门势力、险地、秘境、妖兽

## 🚀 快速开始

### 启动 Web 版本（推荐）⭐

**终端 1 - 后端：**
```bash
cd /Users/xingao/xiuxian
./start_server.sh
```

**终端 2 - 前端：**
```bash
cd /Users/xingao/xiuxian/frontend
npm install  # 首次运行
npm start
```

浏览器自动打开 http://localhost:3001

### 启动 CLI 版本

```bash
cargo run --release
```

选择模式 1（交互）或 2（自动）

## 📚 文档

- [快速启动指南](HOW_TO_RUN.md) - 详细的安装和运行说明 ⭐
- [启动模式说明](STARTUP_MODES.md) - 各种启动方式对比和说明 ⭐
- [API 设计](API_DESIGN.md) - Web API 接口文档
- [Web 部署指南](WEB_DEPLOYMENT_GUIDE.md) - 生产环境部署
- [游戏指南](GUIDE.md) - 游戏机制详解

## 🛠️ 技术栈

### 后端
- Rust 1.71.0
- Axum 0.6 - Web 框架
- Tokio 1.28 - 异步运行时
- Tower-HTTP 0.4 - CORS 中间件
- DashMap 5.5 - 并发状态管理

### 前端
- React 18 + TypeScript
- Axios - HTTP 客户端
- 现代化响应式 UI

## 📋 命令行参数

```bash
# 直接启动 Web 服务器（无需手动选择）⭐ 新增
cargo run --release -- --web
cargo run --release -- -w

# 交互式选择模式
cargo run --release

# 使用启动脚本
./start_server.sh
```

## 🎮 游戏玩法

### Web 版本 ⭐
1. 创建新游戏，输入宗门名称
2. 查看弟子列表和可用任务
3. 手动分配任务或使用自动分配
4. 开始回合生成新任务
5. 结束回合查看执行结果

### CLI 版本 - 交互模式
- **回合制游戏**：每回合手动管理宗门事务
- **任务分配**：亲自决定哪个弟子执行什么任务
- **渡劫决策**：选择最佳时机让弟子渡劫
- **策略深度**：根据弟子资质、道心、年龄制定培养计划
- **沉浸体验**：真正体验作为宗门掌门的感觉

### 🤖 自动模式
- **自动模拟**：AI自动管理宗门运行
- **快速观察**：适合测试和观察长期结果
- **学习参考**：了解游戏机制和策略

## 游戏特性

### 1. 宗门系统
- **弟子类型**：外门、内门、亲传三种弟子
- **资源管理**：通过任务和地图元素获取资源
- **声望系统**：影响资源收入和招募弟子概率
- **仙门目标**：任何弟子达到飞升期即成为仙门（胜利）
- **灭门条件**：所有弟子寿元耗尽或地图怪物成魔（失败）

### 2. 弟子系统
- **修为等级**：练气 → 筑基 → 结丹 → 凝婴 → 化神 → 练虚 → 飞升
- **资质系统**：火、水、木、金、土、剑、炼丹、阵法、医道等多种资质
- **寿元机制**：不同修为等级有不同寿命，死亡后可能留下传承
- **渡劫系统**：高等级需要渡劫突破，成功率受道心和传承影响
- **道心属性**：影响渡劫成功率，通过任务选择影响

### 3. 任务系统
- **采集任务**：获取资源，受木灵根资质加成
- **战斗任务**：讨伐怪物，受剑道资质加成
- **探索任务**：探索秘境和险要之地
- **辅助任务**：守卫、行医等，部分需要特定资质
- **投资任务**：消耗资源提升修为（预留功能）

### 4. 地图元素
- **村庄**：提供采集、守卫、行医任务，产生资源收入
- **势力**：友好势力可交流，敌对势力可镇压
- **险要**：提供游历任务
- **秘境**：探索任务，对应特定资质更容易
- **怪物**：战斗任务，怪物会成长，达到100级会成魔导致游戏失败

### 5. 事件系统
- 年度收入结算
- 弟子招募
- 弟子突破与渡劫
- 弟子寿元变化
- 地图元素刷新
- 传承生成（元婴期以上弟子死亡）

## 项目结构

```
src/
├── main.rs          # 游戏入口和模式选择
├── ui.rs            # 用户界面工具
├── interactive.rs   # 交互式游戏逻辑
├── game.rs          # 自动模式游戏循环
├── cultivation.rs   # 修为等级系统
├── disciple.rs      # 弟子数据结构和逻辑
├── task.rs          # 任务系统
├── map.rs           # 地图元素系统
├── sect.rs          # 宗门管理
└── event.rs         # 事件系统和招募系统
```

## 快速开始

### 安装运行

```bash
# 克隆或下载项目
cd xiuxian

# 运行游戏（推荐使用 release 模式）
cargo run --release

# 或使用开发模式（编译快但运行慢）
cargo run
```

### 首次游戏

1. **选择游戏模式**
   ```
   请选择游戏模式:
     [1] 交互模式 - 回合制，手动管理宗门
     [2] 自动模式 - 自动运行，观察模拟结果
   ```
   建议首次玩家选择 `1` 体验交互模式

2. **输入宗门名称**
   ```
   请输入宗门名称: 青云宗
   ```
   或直接回车使用默认名称

3. **开始游戏**
   - 查看初始弟子信息
   - 进入第一个回合
   - 开始你的修仙之旅！

### 详细教程

- **交互模式指南**：查看 [INTERACTIVE_GUIDE.md](INTERACTIVE_GUIDE.md)
- **游戏机制说明**：查看 [GUIDE.md](GUIDE.md)
- **架构设计文档**：查看 [ARCHITECTURE.md](ARCHITECTURE.md)

## 游戏机制详解

### 修为突破
- 完成任务累积修为进度到100%
- 练气→筑基需要渡劫
- 渡劫成功率 = 基础30% + 道心加成(道心×0.5%) + 传承加成

### 资质系统
- 每个弟子有1-3种资质
- 资质等级1-10，影响对应任务的完成效率
- 特殊资质对某些任务有加成

### 声望机制
- 通过完成任务获得声望
- 声望影响地图元素的资源产出
- 高声望提高弟子招募概率

### 传承系统
- 元婴期及以上弟子死亡留下传承
- 传承可被后续弟子继承（预留功能）
- 传承提供渡劫成功率加成

## 未来扩展功能

当前实现了核心游戏循环，以下功能已预留接口：

1. **道侣系统**：弟子结成道侣，生育子女
2. **子女成年**：继承父母资质的新弟子
3. **传承继承**：弟子主动学习传承
4. **投资任务**：消耗资源加速修炼
5. **更多资质类型**：雷、冰、风、御兽等
6. **互动式任务选择**：玩家手动分配弟子执行任务
7. **更丰富的事件**：宗门大比、宗门战争等

## 技术特点

- 纯 Rust 实现，类型安全
- 模块化设计，易于扩展
- 事件驱动架构
- 随机性和策略性结合

## 示例游戏流程

```
欢迎来到修仙模拟器！
宗门名称：青云宗

========== 第1年 ==========
年度收入：14 资源
收徒：吴十（外门弟子）
吴十完成任务，获得 10 资源，5 声望，5 修为进度

...

========== 第34年 ==========
陈七成功渡劫，晋升至飞升期！
🎉 恭喜！宗门有弟子飞升成仙，成为仙门！
```

## 开发说明

- 使用 `rand` crate 实现随机性
- 采用 Rust 的所有权系统保证内存安全
- 通过事件系统解耦游戏逻辑
- 可通过修改 `main.rs` 中的年数限制调整游戏长度

## 许可证

本项目为学习示例项目。
