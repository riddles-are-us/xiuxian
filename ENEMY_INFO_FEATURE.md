# ğŸ¯ å®ˆå«ä»»åŠ¡æ•Œäººä¿¡æ¯æ˜¾ç¤ºåŠŸèƒ½

## âœ… åŠŸèƒ½æ¦‚è¿°

å®ˆå«ä»»åŠ¡**åªåœ¨æ€ªç‰©å…¥ä¾µç‰¹å®šåœ°ç‚¹æ—¶è§¦å‘**ï¼Œå¹¶æ˜¾ç¤ºè§¦å‘è¯¥ä»»åŠ¡çš„å…·ä½“å¦–é­”ä¿¡æ¯ï¼š
- **å¦–é­”å”¯ä¸€ID**: å¯ä»¥åœ¨åœ°å›¾ä¸Šå®šä½åˆ°å…·ä½“çš„å¦–é­”å®ä¾‹ï¼ˆæ ¼å¼ï¼šmonster_Xï¼‰
- **å¦–é­”åç§°**: å…¥ä¾µè€…çš„åå­—
- **å¦–é­”ç­‰çº§**: æ•Œäººçš„ç­‰çº§

æ¯ä¸ªåœ°å›¾ç”Ÿç‰©éƒ½æœ‰å…¨å±€å”¯ä¸€çš„IDï¼Œç¡®ä¿å¯ä»¥ç²¾ç¡®è¿½è¸ªã€‚

## ğŸ”‘ å…³é”®è®¾è®¡åŸåˆ™

### å®ˆå«ä»»åŠ¡è§¦å‘æœºåˆ¶
- âœ… **åªæœ‰æ€ªç‰©å…¥ä¾µæ‰è§¦å‘**: å®ˆå«ä»»åŠ¡ä»…åœ¨æ€ªç‰©ç§»åŠ¨åˆ°æ‘åº„/åŠ¿åŠ›/ç§˜å¢ƒä½ç½®æ—¶è‡ªåŠ¨ç”Ÿæˆ
- âŒ **ä¸æ˜¯éšæœºç”Ÿæˆ**: ç§»é™¤äº†é…ç½®ä¸­çš„Auxiliaryç±»å‹"å®ˆå«{name}"ä»»åŠ¡
- ğŸ¯ **ä¸€å¯¹ä¸€å…³ç³»**: æ¯ä¸ªå®ˆå«ä»»åŠ¡å¯¹åº”ä¸€ä¸ªå…·ä½“çš„å…¥ä¾µæ€ªç‰©

## ğŸ”§ æŠ€æœ¯å®ç°

### åç«¯æ”¹åŠ¨

#### 1. APIç±»å‹æ‰©å±• (`src/api_types.rs`)

æ·»åŠ äº†æ•Œäººä¿¡æ¯ç»“æ„ï¼š

```rust
/// æ•Œäººä¿¡æ¯ï¼ˆç”¨äºå®šä½åœ°å›¾ä¸Šçš„å…·ä½“æ€ªç‰©ï¼‰
pub struct EnemyInfo {
    pub enemy_id: String,      // æ€ªç‰©å”¯ä¸€IDï¼ˆæ ¼å¼ï¼šmonster_Xï¼‰
    pub enemy_name: String,    // æ€ªç‰©åç§°
    pub enemy_level: u32,      // æ€ªç‰©ç­‰çº§
}

pub struct TaskDto {
    // ... å…¶ä»–å­—æ®µ ...
    pub enemy_info: Option<EnemyInfo>,  // æ•Œäººä¿¡æ¯ï¼ˆæˆ˜æ–—ä»»åŠ¡ï¼‰
}
```

#### 2. ä»»åŠ¡è½¬æ¢é€»è¾‘ (`src/web_server.rs`)

åœ¨TaskDtoè½¬æ¢æ—¶æå–æ•Œäººä¿¡æ¯ï¼š

```rust
// æå–æ•Œäººä¿¡æ¯ï¼ˆå¦‚æœæ˜¯æˆ˜æ–—ä»»åŠ¡ï¼‰
let enemy_info = if let TaskType::Combat(combat_task) = &task.task_type {
    // ä»enemy_nameä¸­æå–IDå’Œåç§°ï¼ˆæ ¼å¼ï¼š"{åç§°}#{ID}"ï¼‰
    let enemy_name_full = &combat_task.enemy_name;
    if let Some(pos) = enemy_name_full.rfind('#') {
        let enemy_name = enemy_name_full[..pos].to_string();
        let enemy_id = format!("monster_{}", &enemy_name_full[pos+1..]);
        Some(EnemyInfo {
            enemy_id,
            enemy_name,
            enemy_level: combat_task.enemy_level,
        })
    } else {
        Some(EnemyInfo {
            enemy_id: "unknown".to_string(),
            enemy_name: enemy_name_full.clone(),
            enemy_level: combat_task.enemy_level,
        })
    }
} else {
    None
};
```

### å‰ç«¯æ”¹åŠ¨

#### 1. TypeScriptç±»å‹ (`frontend/src/api/gameApi.ts`)

```typescript
export interface Task {
  // ... å…¶ä»–å­—æ®µ ...
  enemy_info: {               // æ•Œäººä¿¡æ¯ï¼ˆæˆ˜æ–—ä»»åŠ¡ï¼‰
    enemy_id: string;         // æ€ªç‰©å”¯ä¸€ID
    enemy_name: string;       // æ€ªç‰©åç§°
    enemy_level: number;      // æ€ªç‰©ç­‰çº§
  } | null;
}
```

#### 2. UIæ˜¾ç¤º (`frontend/src/App.tsx`)

åœ¨ä»»åŠ¡å¡ç‰‡ä¸­æ·»åŠ æ•Œäººä¿¡æ¯æ˜¾ç¤ºï¼š

```tsx
{t.enemy_info && (
  <div style={{
    background: '#fff3cd',
    border: '1px solid #ffc107',
    borderRadius: '6px',
    padding: '8px 12px',
    marginBottom: '8px',
    fontSize: '0.9rem'
  }}>
    <strong style={{color: '#856404'}}>âš”ï¸ å…¥ä¾µè€…:</strong>{' '}
    <span style={{color: '#d9534f', fontWeight: 600}}>
      {t.enemy_info.enemy_name}
    </span>
    {' '}
    <span style={{color: '#666'}}>
      (Lv.{t.enemy_info.enemy_level} | ID: {t.enemy_info.enemy_id})
    </span>
  </div>
)}
```

## ğŸ® ç”¨æˆ·ä½“éªŒ

### æ˜¾ç¤ºæ•ˆæœ

å½“æœ‰å®ˆå«ä»»åŠ¡æ—¶ï¼Œä»»åŠ¡å¡ç‰‡ä¼šæ˜¾ç¤ºï¼š

```
ğŸ›¡ï¸ å®ˆå«æ¸…é£é•‡ [ç´§æ€¥]
â° 3å›åˆåå¤±æ•ˆ

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âš”ï¸ å…¥ä¾µè€…: æš—å½±é­”ç‹¼ (Lv.15 | ID: monster_42) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Combat(...)
â±ï¸ éœ€è¦æ‰§è¡Œ 2 å›åˆ
ä¿®ä¸º+50  èµ„æº+30  å£°æœ›+10
```

### ä¿¡æ¯ä»·å€¼

1. **æ€ªç‰©åç§°**: è®©ç©å®¶çŸ¥é“æ˜¯ä»€ä¹ˆç±»å‹çš„æ•Œäºº
2. **ç­‰çº§ä¿¡æ¯**: å¸®åŠ©è¯„ä¼°ä»»åŠ¡éš¾åº¦
3. **å”¯ä¸€ID**: å¯ä»¥åœ¨åœ°å›¾ä¸Šç²¾ç¡®å®šä½è¯¥å¦–é­”
   - æ ¼å¼: `monster_X`ï¼Œå…¶ä¸­Xæ˜¯å…¨å±€é€’å¢çš„å”¯ä¸€æ•°å­—
   - æ¯ä¸ªå¦–é­”ä»å‡ºç”Ÿåˆ°æ­»äº¡ä¿æŒåŒä¸€ID

## ğŸ” æ€ªç‰©IDç³»ç»Ÿ

### IDç”Ÿæˆæœºåˆ¶

```rust
// å…¨å±€å¦–é­”IDè®¡æ•°å™¨
static NEXT_MONSTER_ID: AtomicUsize = AtomicUsize::new(0);

impl Monster {
    pub fn from_template(template: &MonsterTemplate) -> Self {
        let id = NEXT_MONSTER_ID.fetch_add(1, Ordering::SeqCst);
        Self {
            id,  // å”¯ä¸€æ ‡è¯†ç¬¦
            name: template.name.clone(),
            // ...
        }
    }
}
```

### IDç‰¹æ€§

- **å…¨å±€å”¯ä¸€**: ä½¿ç”¨åŸå­è®¡æ•°å™¨ç¡®ä¿ä¸ä¼šé‡å¤
- **é€’å¢é¡ºåº**: æ–°ç”Ÿæˆçš„æ€ªç‰©IDæ€»æ˜¯å¤§äºä¹‹å‰çš„
- **æŒä¹…ç¨³å®š**: æ€ªç‰©ç”Ÿå‘½å‘¨æœŸå†…IDä¸å˜
- **å¯è¿½è¸ª**: å¯ä»¥é€šè¿‡IDåœ¨åœ°å›¾ä¸Šæ‰¾åˆ°å…·ä½“æ€ªç‰©

### IDæ ¼å¼

- **åç«¯å­˜å‚¨**: `usize` ç±»å‹ï¼ˆå¦‚ `42`ï¼‰
- **APIä¼ è¾“**: `String` æ ¼å¼ï¼ˆå¦‚ `"monster_42"`ï¼‰
- **å®ˆå«ä»»åŠ¡å‘½å**: `"{æ€ªç‰©å}#{ID}"` ï¼ˆå¦‚ `"æš—å½±é­”ç‹¼#42"`ï¼‰

## ğŸ“Š æ•°æ®æµ

```
åœ°å›¾ç”Ÿæˆå¦–é­”
    â†“
åˆ†é…å”¯ä¸€ID (NEXT_MONSTER_ID++)
    â†“
å¦–é­”å…¥ä¾µåœ°ç‚¹
    â†“
åˆ›å»ºå®ˆå«ä»»åŠ¡ (enemy_name = "{name}#{id}")
    â†“
APIè¿”å›ä»»åŠ¡æ—¶æå–enemy_info
    â†“
å‰ç«¯æ˜¾ç¤ºæ•Œäººä¿¡æ¯
```

## ğŸ§ª æµ‹è¯•è¦ç‚¹

### åç«¯æµ‹è¯•

1. **IDå”¯ä¸€æ€§**: å¤šä¸ªå¦–é­”ç”Ÿæˆæ—¶IDä¸é‡å¤
2. **IDæå–**: ä» `"{name}#{id}"` æ­£ç¡®è§£æå‡ºIDå’Œåç§°
3. **APIå“åº”**: TaskDtoæ­£ç¡®åŒ…å«enemy_infoå­—æ®µ

### å‰ç«¯æµ‹è¯•

1. **æ˜¾ç¤ºé€»è¾‘**: åªåœ¨æœ‰enemy_infoæ—¶æ˜¾ç¤º
2. **æ ·å¼æ¸²æŸ“**: é»„è‰²è­¦å‘Šæ¡†æ­£ç¡®æ˜¾ç¤º
3. **ä¿¡æ¯å®Œæ•´**: åç§°ã€ç­‰çº§ã€IDéƒ½æ­£ç¡®æ˜¾ç¤º

## ğŸ¯ æœªæ¥æ‰©å±•

### å¯èƒ½çš„å¢å¼º

1. **åœ°å›¾è”åŠ¨**: ç‚¹å‡»æ€ªç‰©IDè·³è½¬åˆ°åœ°å›¾ä¸Šçš„æ€ªç‰©ä½ç½®
2. **æ€ªç‰©è¯¦æƒ…**: æ˜¾ç¤ºæ›´å¤šæ€ªç‰©ä¿¡æ¯ï¼ˆæˆé­”çŠ¶æ€ã€æˆé•¿ç‡ç­‰ï¼‰
3. **æˆ˜æ–—å†å²**: è®°å½•è¯¥æ€ªç‰©çš„æˆ˜æ–—å†å²
4. **æ€ªç‰©è¿½è¸ª**: åœ¨åœ°å›¾ä¸Šé«˜äº®æ˜¾ç¤ºæ­£åœ¨å…¥ä¾µçš„æ€ªç‰©
5. **å¨èƒè¯„ä¼°**: æ ¹æ®æ€ªç‰©ä¿¡æ¯ç»™å‡ºä»»åŠ¡éš¾åº¦å»ºè®®

### å®ç°ç¤ºä¾‹

```typescript
// ç‚¹å‡»è·³è½¬åˆ°åœ°å›¾
const handleEnemyClick = (enemyId: string) => {
  setShowMap(true);
  // åœ¨åœ°å›¾ä¸Šå®šä½å¹¶é«˜äº®è¯¥æ€ªç‰©
  highlightMonster(enemyId);
};

// åœ¨ä»»åŠ¡ä¸­æ·»åŠ ç‚¹å‡»äº‹ä»¶
<span
  onClick={() => handleEnemyClick(t.enemy_info.enemy_id)}
  style={{cursor: 'pointer', textDecoration: 'underline'}}
>
  {t.enemy_info.enemy_name}
</span>
```

## âœ¨ æ€»ç»“

### å®ç°çš„åŠŸèƒ½

âœ… å®ˆå«ä»»åŠ¡**åªåœ¨æ€ªç‰©å…¥ä¾µæ—¶è§¦å‘**ï¼ˆç§»é™¤äº†éšæœºç”Ÿæˆçš„Auxiliaryå®ˆå«ä»»åŠ¡ï¼‰
âœ… å®ˆå«ä»»åŠ¡æ˜¾ç¤ºå…·ä½“å…¥ä¾µè€…ä¿¡æ¯ï¼ˆåç§°ã€ç­‰çº§ã€å”¯ä¸€IDï¼‰
âœ… æ¯ä¸ªåœ°å›¾ç”Ÿç‰©æœ‰å…¨å±€å”¯ä¸€IDï¼ˆmonster_Xæ ¼å¼ï¼‰
âœ… å¯é€šè¿‡IDç²¾ç¡®å®šä½æ€ªç‰©
âœ… APIæ­£ç¡®ä¼ é€’æ•Œäººä¿¡æ¯ï¼ˆTaskDto.enemy_infoå­—æ®µï¼‰
âœ… å‰ç«¯ç¾è§‚åœ°å±•ç¤ºæ•Œäººä¿¡æ¯ï¼ˆé»„è‰²è­¦å‘Šæ¡†ï¼‰

### ç”¨æˆ·ä»·å€¼

- **ä¿¡æ¯é€æ˜**: ç©å®¶æ¸…æ¥šçŸ¥é“åœ¨å¯¹æŠ—ä»€ä¹ˆæ•Œäºº
- **å†³ç­–è¾…åŠ©**: é€šè¿‡ç­‰çº§ä¿¡æ¯åˆ¤æ–­ä»»åŠ¡éš¾åº¦
- **å¯è¿½è¸ªæ€§**: èƒ½åœ¨åœ°å›¾ä¸Šæ‰¾åˆ°å…·ä½“çš„å…¥ä¾µè€…ï¼ˆé€šè¿‡monster_X IDï¼‰
- **æ¸¸æˆæ·±åº¦**: å¢åŠ äº†ç­–ç•¥æ€§å’Œæ²‰æµ¸æ„Ÿ
- **é€»è¾‘ä¸€è‡´æ€§**: å®ˆå«ä»»åŠ¡åªåœ¨çœŸæ­£æœ‰å¨èƒæ—¶å‡ºç°

### ä¿®æ”¹çš„æ–‡ä»¶

1. **åç«¯** (å·²å®Œæˆ):
   - `src/api_types.rs`: æ·»åŠ  EnemyInfo ç»“æ„ä½“
   - `src/web_server.rs`: åœ¨TaskDtoè½¬æ¢æ—¶æå–enemy_infoï¼ˆCombatä»»åŠ¡ï¼‰
   - `src/config.rs`: ç§»é™¤Auxiliary "å®ˆå«{name}" ä»»åŠ¡æ¨¡æ¿

2. **é…ç½®** (å·²å®Œæˆ):
   - `config/map_elements.json`: ç§»é™¤æ‘åº„çš„Auxiliaryå®ˆå«ä»»åŠ¡æ¨¡æ¿

3. **å‰ç«¯** (å·²å®Œæˆ):
   - `frontend/src/api/gameApi.ts`: æ·»åŠ  enemy_info ç±»å‹å®šä¹‰
   - `frontend/src/App.tsx`: æ˜¾ç¤ºæ•Œäººä¿¡æ¯UIç»„ä»¶

### æ€ªç‰©å…¥ä¾µæœºåˆ¶

- æ€ªç‰©æ¯å›åˆæœ‰50%æ¦‚ç‡ç§»åŠ¨ï¼ˆéšæœºé€‰æ‹©ä¸Šä¸‹å·¦å³ï¼‰
- ç§»åŠ¨åˆ°æ‘åº„/åŠ¿åŠ›/ç§˜å¢ƒä½ç½®æ—¶ï¼Œ`invaded_location_id`è¢«è®¾ç½®
- `generate_defense_tasks()`è‡ªåŠ¨åˆ›å»ºCombatç±»å‹å®ˆå«ä»»åŠ¡
- å®ˆå«ä»»åŠ¡çš„`enemy_name`æ ¼å¼ï¼š`"{æ€ªç‰©å}#{ID}"`ï¼ˆå¦‚"æš—å½±é­”ç‹¼#42"ï¼‰
- å‰ç«¯æå–å¹¶æ˜¾ç¤ºï¼šæ€ªç‰©åã€ç­‰çº§ã€ID

ç³»ç»Ÿå·²å®Œå…¨å°±ç»ªï¼ğŸ‰
