# 修仙模拟器 - 快速上手指南

## 安装和运行

### 前置要求
- Rust 1.70+ （推荐使用 rustup 安装）

### 运行游戏
```bash
# 克隆或进入项目目录
cd xiuxian

# 运行游戏
cargo run --release

# 开发模式（编译快但运行慢）
cargo run
```

## 游戏玩法

### 游戏目标

**胜利条件**：
- 任何一个弟子达到飞升期

**失败条件**：
- 所有弟子寿元耗尽（灭门）
- 地图上有怪物成魔（等级达到100）

### 游戏机制

#### 1. 宗门资源
- 初始资源：1000
- 资源来源：
  - 完成任务
  - 年度收入（受声望和地图元素影响）
- 资源用途：未来可用于投资任务

#### 2. 声望系统
- 初始声望：0
- 声望来源：完成任务
- 声望作用：
  - 提高年度收入
  - 提高弟子招募概率
  - 影响与势力的关系

#### 3. 弟子系统

##### 弟子类型
- **外门弟子**：基础弟子，招募概率最高
- **内门弟子**：优秀弟子，招募概率中等
- **亲传弟子**：核心弟子，招募概率最低

##### 修为等级
| 等级 | 寿元 | 是否需要渡劫 |
|------|------|--------------|
| 练气 | 150年 | 否 |
| 筑基 | 300年 | 是 |
| 结丹 | 500年 | 是 |
| 凝婴 | 1000年 | 是 |
| 化神 | 2000年 | 是 |
| 练虚 | 5000年 | 是 |
| 飞升 | 无限 | 是 |

##### 资质系统
- **灵根类资质**：火、水、木、金、土、雷、冰、风
  - 影响对应属性的秘境探索

- **技能类资质**：
  - 剑道：影响战斗任务效率
  - 炼丹：未来可用于炼丹任务
  - 阵法：影响辅助任务
  - 医道：影响行医任务
  - 御兽：未来可用于御兽任务

- **资质等级**：1-10
  - 资质等级越高，对应任务加成越高
  - 加成公式：等级 × 10%

##### 道心系统
- 初始道心：50
- 范围：0-100
- 影响：
  - 渡劫成功率 = 30% + 道心×0.5% + 传承加成
  - 某些任务会影响道心
    - 守卫村庄：+2
    - 行医救人：+5
    - 镇压势力：-5

##### 突破与渡劫
- **突破条件**：修为进度达到100%
- **渡劫机制**：
  ```
  基础成功率 = 30%
  道心加成 = 道心 × 0.5%
  传承加成 = 传承提供的固定加成
  最终成功率 = min(基础 + 道心 + 传承, 95%)
  ```
- **渡劫失败**：弟子身死道消
- **渡劫成功**：晋升至下一等级

##### 传承系统
- **生成条件**：元婴期及以上弟子死亡
- **传承加成**：
  - 凝婴：+10% 渡劫成功率
  - 化神：+15% 渡劫成功率
  - 练虚：+20% 渡劫成功率
- **未来功能**：弟子主动学习传承

#### 4. 任务系统

##### 采集任务
- **来源**：村庄
- **奖励**：少量资源和修为
- **加成**：木灵根资质
- **示例**：在清风镇采集灵药

##### 战斗任务
- **来源**：怪物、敌对势力
- **奖励**：较多资源和声望
- **要求**：弟子修为需达到敌人等级
- **加成**：剑道资质
- **示例**：讨伐噬魂虎

##### 探索任务
- **来源**：秘境、险要之地
- **奖励**：大量资源和修为
- **要求**：修为×10 ≥ 危险等级
- **加成**：对应秘境类型的灵根
- **示例**：探索火焰洞窟

##### 辅助任务
- **来源**：村庄、友好势力
- **奖励**：声望和道心
- **要求**：某些需要特定资质
- **示例**：
  - 守卫村庄（无要求）
  - 行医救人（需要医道资质）
  - 势力交流（无要求）

#### 5. 地图元素

##### 村庄
- **任务**：采集、守卫、行医
- **收入**：根据繁荣度和声望
- **示例**：
  - 清风镇（人口1000，繁荣度50）
  - 灵泉村（人口500，繁荣度30）

##### 势力
- **友好关系**（>0）：
  - 提供交流任务
  - 高声望时提供资源收入
- **敌对关系**（<-30）：
  - 提供镇压任务
  - 完成获得大量声望但降低道心

##### 险要之地
- **任务**：游历任务
- **特点**：危险等级不同
- **示例**：迷雾森林

##### 秘境
- **任务**：探索任务
- **特点**：对应特定灵根类型
- **示例**：火焰洞窟（火灵根加成）

##### 怪物
- **任务**：讨伐任务
- **成长**：每年10%概率提升等级
- **成魔**：等级达到100导致游戏失败
- **刷新**：每年20%概率出现新怪物

## 游戏策略

### 前期（1-10年）
**目标**：积累资源和声望

**策略**：
1. 优先完成村庄任务（安全且稳定）
2. 医道资质弟子优先行医（高声望+道心）
3. 避免高难度战斗任务
4. 关注弟子修为进度

### 中期（10-50年）
**目标**：培养核心弟子突破

**策略**：
1. 选择高资质弟子重点培养
2. 完成探索任务（高修为奖励）
3. 战斗任务选择修为高的弟子
4. 注意渡劫成功率
5. 利用传承提升渡劫成功率

### 后期（50年+）
**目标**：冲刺飞升

**策略**：
1. 集中资源培养最有潜力的弟子
2. 确保高道心（90+）再渡劫
3. 使用传承加成
4. 警惕怪物成魔
5. 注意弟子寿元

## 游戏数据解读

### 弟子信息示例
```
名字: 陈七
类型: 外门弟子
修为: 化神 (85%)
年龄: 150/2000
道心: 95
资质: Fire(7) Sword(8) Alchemy(5)
传承: 云飞扬的传承 (渡劫加成: 15.0%)
```

**解读**：
- 修为进度85%，还需15%即可尝试渡劫
- 年龄150岁，寿元还很充足
- 道心95，渡劫成功率 = 30% + 95×0.5% + 15% = 92.5%
- 有火灵根7级，适合探索火焰秘境
- 有剑道8级，战斗任务效率高

### 宗门统计示例
```
=== 宗门统计 ===
年份: 34
弟子总数: 21
  外门: 12
  内门: 9
  亲传: 0
资源: 8510
声望: 2985

修为分布:
  练气: 18
  筑基: 2
  飞升: 1
```

**解读**：
- 游戏进行到第34年
- 共21名弟子，主要是外门和内门
- 资源充足（8510）
- 声望很高（2985），年度收入和招募都很好
- 大部分弟子还在练气期，需要加速培养

## 常见问题

### Q: 弟子为什么不突破？
A: 需要修为进度达到100%。通过完成任务累积进度。

### Q: 渡劫总是失败怎么办？
A:
1. 提升道心（完成正面任务）
2. 获取传承（让高修为弟子死后留下）
3. 确保90+道心再渡劫

### Q: 资源不够用怎么办？
A:
1. 提升声望增加年度收入
2. 多完成任务
3. 完成高奖励的探索任务

### Q: 怎么避免灭门？
A:
1. 持续招募新弟子
2. 年轻弟子优先培养
3. 不要让所有弟子都去渡劫

### Q: 怎么防止怪物成魔？
A:
1. 及时完成战斗任务
2. 培养战斗型弟子（剑道资质高）
3. 如果看到高等级怪物立即处理

## 修改游戏参数

### 调整游戏时长
编辑 `src/main.rs`:
```rust
// 运行100年
game.run(100);

// 改为运行200年
game.run(200);
```

### 调整初始资源
编辑 `src/sect.rs`:
```rust
pub fn new(name: String) -> Self {
    Self {
        // ...
        resources: 1000,  // 改为你想要的初始资源
        // ...
    }
}
```

### 调整渡劫成功率
编辑 `src/disciple.rs`:
```rust
pub fn tribulation_success_rate(&self) -> f32 {
    let base_rate = 0.3;  // 改为0.5可以提高基础成功率到50%
    // ...
}
```

### 调整招募概率
编辑 `src/event.rs`:
```rust
pub fn try_recruit(&mut self, sect: &Sect) -> Option<Disciple> {
    let recruit_chance = if sect.reputation > 100 {
        0.5  // 改为0.8可以提高招募概率
    }
    // ...
}
```

## 技巧和建议

1. **资质比修为重要**：一个高资质的练气弟子比低资质的筑基弟子更有培养价值

2. **道心管理**：避免让高潜力弟子完成降低道心的任务

3. **传承利用**：元婴期以上的低潜力弟子可以"牺牲"留下传承

4. **年龄管理**：寿元快耗尽的弟子不要继续培养

5. **声望优先**：前期优先提升声望，带来的收益是长期的

6. **风险控制**：不要所有弟子同时渡劫，避免团灭

7. **怪物管理**：定期清理高等级怪物，避免成魔

## 下一步

1. 熟悉游戏机制，多玩几局
2. 尝试不同的策略
3. 修改游戏参数，定制自己的游戏
4. 扩展游戏功能（参考 ARCHITECTURE.md）
5. 添加新的任务类型、地图元素或事件

祝你在修仙之路上一帆风顺！
