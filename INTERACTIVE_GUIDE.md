# 交互式游戏指南

## 游戏模式

游戏现在提供两种模式：

### 1. 交互模式（推荐）
- 回合制游戏
- 玩家手动管理宗门
- 分配任务给弟子
- 决定弟子是否渡劫
- 体验完整的策略游戏

### 2. 自动模式
- 自动模拟运行
- 观察AI管理宗门
- 适合快速测试和观察长期结果

## 启动游戏

```bash
cargo run --release
```

启动后选择游戏模式：
```
欢迎来到修仙世界！

请选择游戏模式:
  [1] 交互模式 - 回合制，手动管理宗门
  [2] 自动模式 - 自动运行，观察模拟结果

请选择 (1-2): 1
```

输入宗门名称（可留空使用默认名）

## 交互模式游戏流程

### 回合开始阶段

每个回合开始时会自动发生：

1. **年度收入**
   - 根据声望和地图元素计算资源收入
   - 自动添加到宗门资源

2. **弟子招募**
   - 根据声望随机招募新弟子
   - 显示新弟子信息

3. **年龄增长**
   - 所有弟子年龄+1
   - 寿元耗尽的弟子死亡并留下传承（元婴+）

4. **突破检查**
   - 自动检查是否有弟子达到突破条件
   - 对于需要渡劫的，询问玩家是否渡劫

5. **任务生成**
   - 从地图元素生成本回合可用任务
   - 玩家需要分配这些任务

### 主菜单操作

每个回合中，玩家可以进行以下操作：

```
第 X 年 - 主菜单

--- 请选择操作 ---
  [1] 查看宗门状态
  [2] 查看弟子列表
  [3] 查看任务列表
  [4] 分配任务
  [5] 执行任务，结束回合

请选择 (输入序号):
```

#### 选项 1：查看宗门状态

显示宗门的完整统计信息：

```
=== 宗门统计 ===
年份: 5
弟子总数: 8
  外门: 5
  内门: 3
  亲传: 0
资源: 2450
声望: 350

修为分布:
  练气: 6
  筑基: 2
```

#### 选项 2：查看弟子列表

显示所有存活弟子的详细信息：

```
弟子列表

[1] 云飞扬
    类型: 内门
    修为: 筑基 (进度: 65%)
    年龄: 85/300
    道心: 75
    资质: Fire(7) Sword(8) Alchemy(5)
    可执行任务数: 8

[2] 张三
    类型: 外门
    修为: 练气 (进度: 45%)
    年龄: 23/150
    道心: 50
    资质: Medical(6) Wood(4)
    可执行任务数: 4
```

**关键信息解读**：
- **修为进度**：达到100%可以突破
- **年龄/寿命**：寿命快耗尽的弟子不建议培养
- **道心**：影响渡劫成功率
- **资质**：决定适合执行什么任务

#### 选项 3：查看任务列表

显示本回合所有可用任务：

```
本回合可用任务

[1] 在清风镇采集灵药 ⭕ 未分配
    类型: Gathering(GatheringTask { resource_type: "灵药", difficulty: 1 })
    奖励: 修为+5, 资源+10, 声望+5
    适合弟子: 云飞扬, 张三, 王五

[2] 讨伐噬魂虎 ✓ 已分配给: 云飞扬
    类型: Combat(CombatTask { enemy_name: "噬魂虎", enemy_level: 2, difficulty: 2 })
    奖励: 修为+15, 资源+40, 声望+25
    道心影响: +3
    适合弟子: 云飞扬, 赵六
```

**任务状态**：
- ⭕ 未分配：还没有指派弟子
- ✓ 已分配：已经指派给某个弟子

**适合弟子**：系统自动计算哪些弟子适合该任务

#### 选项 4：分配任务

进入任务分配界面：

```
1. 分配任务
2. 取消分配
3. 自动分配所有未分配任务
4. 完成分配，进入下一阶段
```

##### 手动分配任务流程

1. 选择 `1. 分配任务`

2. 从任务列表中选择一个任务：
   ```
   选择要分配的任务:
     [1] ⭕ 在清风镇采集灵药
     [2] ⭕ 守卫清风镇
     [3] ⭕ 讨伐噬魂虎

   任务序号 (0=取消): 3
   ```

3. 从适合的弟子中选择一个：
   ```
   选择执行弟子:
     [1] 云飞扬 - 筑基 (65%)
     [2] 赵六 - 练气 (80%)

   弟子序号 (0=取消): 1
   ```

4. 确认分配：
   ```
   ✅ 已将任务 [讨伐噬魂虎] 分配给 云飞扬
   ```

##### 自动分配

选择 `3. 自动分配所有未分配任务`

系统会自动为每个未分配的任务选择第一个适合的弟子。

##### 取消分配

选择 `2. 取消分配`

从已分配的任务中选择一个取消分配。

#### 选项 5：执行任务，结束回合

执行所有已分配的任务并显示结果：

```
任务执行结果

✅ 云飞扬 完成任务 [讨伐噬魂虎]
   获得: 修为+15, 资源+40, 声望+25
   道心变化: +3

✅ 张三 完成任务 [在清风镇采集灵药]
   获得: 修为+5, 资源+10, 声望+5

❌ 王五 执行任务 [探索火焰洞窟] 失败

按回车键查看回合总结...
```

**注意事项**：
- 未分配的任务不会执行
- 任务有一定失败概率（默认20%）
- 失败的任务不会获得奖励

### 渡劫决策

当弟子修为达到100%且需要渡劫时，游戏会询问玩家：

```
⚠️  云飞扬 已达到大圆满，可以尝试渡劫

当前渡劫成功率: 62.5%
  道心: 75
  传承加成: 10.0%

是否尝试渡劫? (y/n):
```

**决策建议**：
- 成功率 < 50%：建议等待，继续完成任务提升道心
- 成功率 50-70%：有一定风险，看弟子潜力决定
- 成功率 > 70%：建议尝试
- 成功率 > 90%：强烈建议尝试

**渡劫结果**：
- 成功：晋升至下一个修为等级
- 失败：弟子身死道消（元婴+会留下传承）

### 游戏结束

#### 胜利条件
任何一个弟子达到飞升期

```
🎉 游戏胜利！

恭喜！宗门有弟子飞升成仙，成为仙门！

游戏用时: 34 年
```

#### 失败条件

1. 所有弟子寿元耗尽
   ```
   💀 游戏失败

   宗门所有弟子寿元耗尽，宗门覆灭...

   游戏用时: 150 年
   ```

2. 怪物成魔
   ```
   👹 游戏失败

   地图上出现了成魔的怪物，天下大乱！

   游戏用时: 45 年
   ```

## 策略技巧

### 任务分配策略

1. **资质匹配**
   - 医道资质 → 行医任务（高声望+道心）
   - 剑道资质 → 战斗任务（高资源+声望）
   - 灵根资质 → 对应秘境探索

2. **修为平衡**
   - 高修为弟子：战斗任务、探索任务
   - 低修为弟子：采集任务、辅助任务

3. **道心管理**
   - 准备渡劫的弟子：优先执行提升道心的任务
   - 避免让关键弟子执行降低道心的任务（如镇压）

4. **优先级排序**
   - 优先分配高奖励任务
   - 确保每个弟子都有任务（不要浪费回合）
   - 注意任务的适配性

### 渡劫时机选择

1. **道心优化**
   - 渡劫前几个回合专注提升道心
   - 执行：行医(+5)、守卫(+2)等任务
   - 避免：镇压(-5)等任务

2. **传承利用**
   - 让低潜力的元婴+弟子"牺牲"留下传承
   - 高潜力弟子获得传承后再渡劫

3. **风险评估**
   - 弟子年龄接近寿元：激进渡劫
   - 弟子年轻且潜力高：保守渡劫（90%+）
   - 宗门弟子充足：可以冒险
   - 宗门弟子稀少：保守为主

### 资源管理

1. **声望优先**
   - 前期优先提升声望
   - 高声望带来更多收入和弟子

2. **长期投资**
   - 培养高资质弟子
   - 不要浪费资源在低潜力弟子上

3. **风险控制**
   - 保持一定弟子数量
   - 不要让所有弟子同时渡劫

### 怪物管理

1. **及时清理**
   - 定期完成战斗任务
   - 防止怪物等级过高

2. **优先级**
   - 高等级怪物（80+）立即处理
   - 多个怪物优先击杀高等级的

## 界面操作说明

### 输入方式

- **选择选项**：输入数字后按回车
- **输入文本**：直接输入后按回车
- **确认操作**：输入 y 或 n
- **取消操作**：通常输入 0

### 快捷操作

- 大部分界面按回车继续
- 可以留空使用默认值（如宗门名称）
- 输入 0 通常表示取消当前操作

### 信息符号

- ✅ 成功/完成
- ❌ 失败/错误
- ⚠️  警告/重要提示
- ℹ️  信息提示
- ⭕ 未分配/未完成
- ✓ 已分配/已完成
- 🎉 胜利
- 💀 失败
- 👹 危险

## 常见问题

### Q: 任务可以不分配吗？
A: 可以。未分配的任务不会执行，但不会有负面影响。建议尽量分配以最大化收益。

### Q: 一个弟子可以执行多个任务吗？
A: 不可以。每个弟子每回合只能执行一个任务。

### Q: 渡劫失败后弟子会怎样？
A: 弟子会死亡。如果是元婴期及以上，会留下传承供后续弟子使用。

### Q: 如何提高渡劫成功率？
A: 1) 提升道心（多做正面任务）2) 获取传承 3) 等待更好的时机

### Q: 自动分配的策略是什么？
A: 系统会为每个任务选择第一个适合的弟子。建议手动分配以优化效率。

### Q: 可以跳过回合吗？
A: 可以。不分配任务直接选择"执行任务，结束回合"即可。但会浪费一个回合的成长机会。

### Q: 游戏可以保存吗？
A: 当前版本不支持保存。每次运行都是新游戏。

## 开发计划

未来可能添加的功能：
- [ ] 游戏存档/读档
- [ ] 更多任务类型
- [ ] 弟子装备系统
- [ ] 道侣和子女系统实现
- [ ] 宗门建筑系统
- [ ] 更丰富的随机事件
- [ ] 成就系统
- [ ] 难度选择

## 反馈建议

如果在游戏过程中有任何问题或建议，欢迎反馈！
